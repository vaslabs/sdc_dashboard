{% extends "base.html" %}
{% block head %}
<title>My dashboard</title>
{% endblock %}
{% block content %}
    <style type="text/css">
      html, body { height: 100%; margin: 0; padding: 0;}
      #map-canvas {height: 100%; width: 75%;}
      #control-panel {height: 100%; width: 25%; background-color: blue;}
    </style>
    <script type="text/javascript"
      src="https://maps.googleapis.com/maps/api/js?">
    </script>
    
    
    <script type="text/javascript">

      function getMyData() {
        getJSONResponse('/dashboard/session', initialize);
      }

      var map;
      var myData;
      function initialize(data) {
        var latitude = data.gpsEntries[0].latitude;
        var longitude = data.gpsEntries[0].longitude;
        var mapOptions = {
          center: { lat: latitude, lng: longitude},
          zoom: 16
        };
        map = new google.maps.Map(document.getElementById('map-canvas'),
            mapOptions);
        myData = data;
      }
      google.maps.event.addDomListener(window, 'load', getMyData);
    </script>
    <script type="text/javascript">

      function startAnimating(data) {
      
          var lat = data.gpsEntries[0].latitude;
          var lng = data.gpsEntries[0].longitude;
          var myLatlng = new google.maps.LatLng(lat,lng);
          var mapOptions = {
            zoom: 16,
            center: myLatlng
          }

          var marker = new google.maps.Marker({
              position: myLatlng,
              map: map,
              title: 'GPS data'
          });
          
          
          marker.setIcon("http://maps.google.com/mapfiles/ms/icons/red-dot.png");
          moveMarker(0, marker, data);
          
          
              
      }
      
      function drawPath(data) {
          var flightPlanCoordinates = [];
          for (var i = 0; i < data.gpsEntries.length; i++) {
              flightPlanCoordinates.push(new google.maps.LatLng(data.gpsEntries[i].latitude, data.gpsEntries[i].longitude));
          }
          var flightPath = new google.maps.Polyline({
          path: flightPlanCoordinates,
          geodesic: true,
          strokeColor: '#FF0000',
          strokeOpacity: 1.0,
          strokeWeight: 2
          });

          flightPath.setMap(map);
      }
        
      
      
      function moveMarker(i, marker, data) {
              var lat = data.gpsEntries[i].latitude;
              var lng = data.gpsEntries[i].longitude;
              var position = new google.maps.LatLng(lat, lng);
              marker.setPosition(position);
              map.panTo(position);
              if (i < data.gpsEntries.length - 1) {
                var timeout = data.gpsEntries[i+1].timestamp - data.gpsEntries[i].timestamp;
                setTimeout(function () { moveMarker(i+1, marker, data); }, timeout/100);
            }
      }

        
    </script>
<div id="map-canvas"></div>
<div id="control-panel"></div>
{% endblock content %}